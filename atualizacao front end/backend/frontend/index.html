<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Review de Filme — Estilo IMDb</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Cinephilia</h1>
  </header>

  <!-- Carrossel de Imagens -->
  <div class="carousel">
    <button class="prev" onclick="moveSlide(-1)">&#10094;</button>
    <div class="carousel-images" id="carouselImages"></div>
    <button class="next" onclick="moveSlide(1)">&#10095;</button>
  </div>

  <div class="movie-info">
  <img id="images" src="" alt="Poster">

  <div class="details">
    <h2 id="name">Carregando...</h2>

    <p id="release_date"></p>
    <p id="age_classification"></p>
    <p id="status"></p>
    <p id="genres"></p>
    <p id="country"></p>
    <p id="duration"></p>
    <p id="budget"></p>

    <div class="rating" id="average_score"></div>
  </div>
</div>

    <!-- FORM DE REVIEW CORRIGIDO -->
    <div class="review-box">
      <h3>Enviar Review</h3>

      <form id="formReview" action="../api/review/create.php" method="POST">
        <input type="hidden" id="movie_id" name="movie_id" placeholder="ID do Filme" required><br>
        <input type="number" step="0.1" min="0" max="5" id="score" name="score" placeholder="Nota (0 a 5)" required><br>
        <textarea id="message" name="message" placeholder="Comentário" required></textarea><br>
        <button type="submit">Enviar Review</button>
      </form>
    </div>

    <div class="user-reviews" id="reviewsList">
      <h3>Reviews dos usuários</h3>
    </div>
  </div>

  <script>
    let slideIndex = 0;

    // ==========================
    // 1) CARREGAR DADOS DO FILME
    // ==========================
    async function loadMovieData() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if (!id) return alert("Nenhum ID encontrado na URL");

      document.getElementById("movie_id").value = id;

      try {
        const res = await fetch("../api/movies/get.php?id=" + id);
        const data = await res.json();

        document.getElementById("images").src = data.images[0]; 
        document.getElementById("name").textContent = data.name;
        document.getElementById("release_date").innerHTML = `<strong>Lançamento:</strong> ${data.release_date}`;
        document.getElementById("age_classification").innerHTML = `<strong>Classificação:</strong> ${data.age_classification}`;
        document.getElementById("status").innerHTML = `<strong>Status:</strong> ${data.status}`;
        document.getElementById("genres").innerHTML = `<strong>Gêneros:</strong> ${data.genres.join(", ")}`;
        document.getElementById("country").innerHTML = `<strong>País:</strong> ${data.country}`;
        document.getElementById("duration").innerHTML = `<strong>Duração:</strong> ${data.duration} min`;
        document.getElementById("budget").innerHTML = `<strong>Orçamento:</strong> $${data.budget}`;
        document.getElementById("average_score").textContent = `&#11088 ${data.average_score}`;

        const container = document.getElementById("carouselImages");
        container.innerHTML = "";

        data.imagens.forEach((url) => {
          const img = document.createElement("img");
          img.src = url;
          container.appendChild(img);
        });
      } catch (error) {
        console.error("Erro ao carregar filme:", error);
      }
    }

    // ==========================
    // 2) CARROSSEL
    // ==========================
    function moveSlide(n) {
      const slides = document.querySelector(".carousel-images");
      const total = slides.children.length;

      slideIndex = (slideIndex + n + total) % total;
      slides.style.transform = `translateX(${-slideIndex * 100}%)`;
    }

    loadMovieData();
  </script>
</body>
</html>
